# ç›‘æ§ç³»ç»Ÿå¿«é€Ÿä½¿ç”¨æŒ‡å—

**ç‰ˆæœ¬**: 1.0
**æ›´æ–°æ—¥æœŸ**: 2025-11-09

---

## âœ… å·²å®æ–½åŠŸèƒ½

### 1. å¥åº·æ£€æŸ¥ç«¯ç‚¹

**ç”¨é€”**: ä¾›å¤–éƒ¨ç›‘æ§ç³»ç»Ÿã€è´Ÿè½½å‡è¡¡å™¨ä½¿ç”¨

| ç«¯ç‚¹ | ç”¨é€” | å“åº”ç¤ºä¾‹ |
|------|------|---------|
| `/health/` | å­˜æ´»æ€§æ£€æŸ¥ | `{"status": "ok", "service": "agent-source-db"}` |
| `/health/ready/` | å°±ç»ªæ€§æ£€æŸ¥ | `{"status": "ready", "checks": {...}}` |
| `/health/db/` | æ•°æ®åº“æ£€æŸ¥ | `{"status": "ok", "database": {...}}` |

**æµ‹è¯•å‘½ä»¤**:
```bash
# å­˜æ´»æ€§æ£€æŸ¥
curl http://localhost:8000/health/

# å°±ç»ªæ€§æ£€æŸ¥ï¼ˆåŒ…å«æ•°æ®åº“å’Œè¿ç§»çŠ¶æ€ï¼‰
curl http://localhost:8000/health/ready/

# æ•°æ®åº“è¯¦ç»†æ£€æŸ¥
curl http://localhost:8000/health/db/
```

---

### 2. ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿ

**æ—¥å¿—ç›®å½•**: `logs/`

| æ—¥å¿—æ–‡ä»¶ | å†…å®¹ | ç”¨é€” |
|---------|------|------|
| `django.log` | æ‰€æœ‰æ—¥å¿— | å®Œæ•´è®°å½• |
| `access.log` | HTTP è¯·æ±‚æ—¥å¿— | æµé‡åˆ†æ |
| `error.log` | é”™è¯¯å’Œè­¦å‘Š | æ•…éšœæ’æŸ¥ |
| `db.log` | æ•°æ®åº“æ…¢æŸ¥è¯¢ | æ€§èƒ½ä¼˜åŒ– |

**æ—¥å¿—ç‰¹æ€§**:
- âœ… è‡ªåŠ¨è½®è½¬ï¼ˆå•æ–‡ä»¶æœ€å¤§ 50MBï¼‰
- âœ… ä¿ç•™æœ€è¿‘ 10 ä¸ªæ–‡ä»¶
- âœ… ç»“æ„åŒ–æ ¼å¼ï¼ˆä¾¿äºè§£æï¼‰

**æŸ¥çœ‹æ—¥å¿—**:
```bash
# å®æ—¶æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
tail -f logs/django.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f logs/error.log

# æŸ¥çœ‹è®¿é—®æ—¥å¿—
tail -f logs/access.log

# æœç´¢ç‰¹å®šé”™è¯¯
grep "ERROR" logs/error.log
```

---

### 3. Admin ç›‘æ§é¢æ¿

**è®¿é—®åœ°å€**: http://localhost:8000/admin/system-status/

**è¦æ±‚**: éœ€è¦ staff æˆ– superuser æƒé™

**æ˜¾ç¤ºå†…å®¹**:
- âœ… æ•°æ®åº“è¿æ¥çŠ¶æ€å’Œå“åº”æ—¶é—´
- âœ… æ•°æ®ç»Ÿè®¡ï¼ˆAgentCardã€Namespaceã€Schema æ•°é‡ï¼‰
- âœ… æœ€è¿‘ 50 æ¡é”™è¯¯æ—¥å¿—

**è®¿é—®æ­¥éª¤**:
1. ç™»å½• Django Admin: http://localhost:8000/admin/
2. è®¿é—®ç›‘æ§é¢æ¿: http://localhost:8000/admin/system-status/
3. æˆ–ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥å®Œæ•´ URL

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•

### æµ‹è¯• 1: å¥åº·æ£€æŸ¥ç«¯ç‚¹

```bash
# ç¡®ä¿æœåŠ¡æ­£åœ¨è¿è¡Œ
docker-compose ps

# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:8000/health/
curl http://localhost:8000/health/ready/
curl http://localhost:8000/health/db/
```

**é¢„æœŸç»“æœ**: æ‰€æœ‰ç«¯ç‚¹è¿”å› 200 OK å’Œ JSON æ•°æ®

---

### æµ‹è¯• 2: æ—¥å¿—ç³»ç»Ÿ

```bash
# ç”Ÿæˆä¸€äº›è®¿é—®æ—¥å¿—
curl http://localhost:8000/api/agentcards/
curl http://localhost:8000/health/

# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
ls -lh logs/
cat logs/django.log
```

**é¢„æœŸç»“æœ**:
- æ—¥å¿—æ–‡ä»¶å·²åˆ›å»º
- åŒ…å«åˆšæ‰çš„ HTTP è¯·æ±‚è®°å½•

---

### æµ‹è¯• 3: Admin ç›‘æ§é¢æ¿

```bash
# æ–¹æ³• 1: å¦‚æœå·²æœ‰ superuser
# ç›´æ¥è®¿é—® http://localhost:8000/admin/system-status/

# æ–¹æ³• 2: åˆ›å»ºæ–°çš„ superuser
docker-compose exec web python manage.py createsuperuser

# ç„¶ååœ¨æµè§ˆå™¨ä¸­ï¼š
# 1. è®¿é—® http://localhost:8000/admin/
# 2. ç™»å½•
# 3. è®¿é—® http://localhost:8000/admin/system-status/
```

**é¢„æœŸç»“æœ**:
- çœ‹åˆ°ç³»ç»ŸçŠ¶æ€ç›‘æ§é¡µé¢
- æ˜¾ç¤ºæ•°æ®åº“çŠ¶æ€ï¼ˆç»¿è‰²âœ“è¡¨ç¤ºæ­£å¸¸ï¼‰
- æ˜¾ç¤ºæ•°æ®ç»Ÿè®¡
- æ˜¾ç¤ºæœ€è¿‘é”™è¯¯æ—¥å¿—

---

## ğŸ“Š ç›‘æ§æŒ‡æ ‡è¯´æ˜

### æ•°æ®åº“å“åº”æ—¶é—´

| å“åº”æ—¶é—´ | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| < 10ms | ä¼˜ç§€ | æ•°æ®åº“æ€§èƒ½è‰¯å¥½ |
| 10-50ms | è‰¯å¥½ | æ­£å¸¸èŒƒå›´ |
| > 50ms | è¾ƒæ…¢ | éœ€è¦ä¼˜åŒ–æŸ¥è¯¢æˆ–æ£€æŸ¥ç½‘ç»œ |
| > 100ms | è­¦å‘Š | å¯èƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜ |

### å¥åº·æ£€æŸ¥è¿”å›ç 

| HTTP çŠ¶æ€ç  | å«ä¹‰ | å¤„ç†å»ºè®® |
|------------|------|---------|
| 200 OK | æœåŠ¡æ­£å¸¸ | æ— éœ€æ“ä½œ |
| 503 Service Unavailable | æœåŠ¡ä¸å¯ç”¨ | æ£€æŸ¥æ•°æ®åº“è¿æ¥æˆ–è¿ç§»çŠ¶æ€ |

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: å¥åº·æ£€æŸ¥è¿”å› 503

**å¯èƒ½åŸå› **:
- æ•°æ®åº“è¿æ¥å¤±è´¥
- æœ‰æœªåº”ç”¨çš„è¿ç§»

**æ’æŸ¥æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥æ•°æ®åº“å®¹å™¨çŠ¶æ€
docker-compose ps

# 2. æŸ¥çœ‹ web å®¹å™¨æ—¥å¿—
docker-compose logs web

# 3. æ£€æŸ¥è¿ç§»çŠ¶æ€
docker-compose exec web python manage.py showmigrations

# 4. åº”ç”¨è¿ç§»ï¼ˆå¦‚æœæœ‰æœªåº”ç”¨çš„ï¼‰
docker-compose exec web python manage.py migrate
```

---

### é—®é¢˜ 2: æ—¥å¿—æ–‡ä»¶æœªç”Ÿæˆ

**å¯èƒ½åŸå› **:
- logs ç›®å½•æƒé™é—®é¢˜
- æœåŠ¡æœªå¯åŠ¨

**æ’æŸ¥æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥æ—¥å¿—ç›®å½•æ˜¯å¦å­˜åœ¨
ls -la logs/

# 2. æ£€æŸ¥ç›®å½•æƒé™
# ç¡®ä¿è¿è¡Œå®¹å™¨çš„ç”¨æˆ·æœ‰å†™æƒé™

# 3. æ‰‹åŠ¨åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p logs

# 4. é‡å¯æœåŠ¡
docker-compose restart web
```

---

### é—®é¢˜ 3: Admin ç›‘æ§é¢æ¿æ— æ³•è®¿é—®

**å¯èƒ½åŸå› **:
- æœªç™»å½•æˆ–æƒé™ä¸è¶³
- URL è·¯ç”±é…ç½®é”™è¯¯

**æ’æŸ¥æ­¥éª¤**:
```bash
# 1. ç¡®è®¤ç”¨æˆ·æ˜¯ staff æˆ– superuser
docker-compose exec web python manage.py shell
>>> from django.contrib.auth.models import User
>>> user = User.objects.get(username='your_username')
>>> print(f"is_staff: {user.is_staff}, is_superuser: {user.is_superuser}")
>>> exit()

# 2. æŸ¥çœ‹ URL é…ç½®
docker-compose exec web python manage.py show_urls | grep system-status

# 3. æ£€æŸ¥ web æ—¥å¿—
docker-compose logs web | tail -50
```

---

## ğŸ“ˆ æ—¥å¸¸ç›‘æ§å»ºè®®

### æ¯æ—¥æ£€æŸ¥
- âœ… è®¿é—® Admin ç›‘æ§é¢æ¿æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
- âœ… æ£€æŸ¥ error.log æ˜¯å¦æœ‰æ–°é”™è¯¯
- âœ… ç¡®è®¤æ•°æ®åº“å“åº”æ—¶é—´æ­£å¸¸ï¼ˆ< 50msï¼‰

### æ¯å‘¨æ£€æŸ¥
- âœ… æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œç¡®ä¿è½®è½¬æ­£å¸¸
- âœ… æ£€æŸ¥æ•°æ®ç»Ÿè®¡ï¼Œç¡®è®¤æ•°æ®å¢é•¿æ­£å¸¸
- âœ… å®¡æŸ¥æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆdb.logï¼‰

### å‘Šè­¦è®¾ç½®å»ºè®®
- âš ï¸ `/health/ready/` è¿ç»­ 2 æ¬¡å¤±è´¥ â†’ ç«‹å³å‘Šè­¦
- âš ï¸ æ•°æ®åº“å“åº”æ—¶é—´ > 100ms â†’ è­¦å‘Š
- âš ï¸ ç£ç›˜ç©ºé—´ > 80% â†’ è­¦å‘Š

---

## ğŸ”§ é…ç½®æ–‡ä»¶ä½ç½®

| ç»„ä»¶ | é…ç½®æ–‡ä»¶ | è¯´æ˜ |
|------|---------|------|
| å¥åº·æ£€æŸ¥ | `documents/health.py` | å¥åº·æ£€æŸ¥é€»è¾‘ |
| ç›‘æ§è§†å›¾ | `documents/admin_views.py` | Admin ç›‘æ§é¢æ¿ |
| æ—¥å¿—é…ç½® | `core/settings.py` (LOGGING) | æ—¥å¿—ç³»ç»Ÿé…ç½® |
| URL è·¯ç”± | `core/urls.py` | ç«¯ç‚¹è·¯ç”± |
| æ¨¡æ¿ | `documents/templates/admin/system_status.html` | ç›‘æ§é¢æ¿ç•Œé¢ |

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **MONITORING.md** - å®Œæ•´çš„ç›‘æ§æ–¹æ¡ˆè®¾è®¡æ–‡æ¡£
- **DEPLOYMENT.md** - éƒ¨ç½²æ–‡æ¡£ï¼ˆç”Ÿäº§ç¯å¢ƒé…ç½®ï¼‰
- **ADMIN_GUIDE.md** - Admin ç•Œé¢ä½¿ç”¨æŒ‡å—

---

## ğŸ¯ ä¸‹ä¸€æ­¥æ‰©å±•

å½“åŸºç¡€ç›‘æ§ä¸å¤Ÿç”¨æ—¶ï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. **å¤–éƒ¨ç›‘æ§æœåŠ¡**ï¼ˆå…è´¹ï¼‰
   - UptimeRobot - ç›‘æ§ `/health/ready/` ç«¯ç‚¹
   - Sentry - è‡ªåŠ¨æ•è·å’Œèšåˆé”™è¯¯

2. **æŒ‡æ ‡æ”¶é›†**ï¼ˆè‡ªæ‰˜ç®¡ï¼‰
   - Prometheus + Grafana
   - å¯è§†åŒ–ä»ªè¡¨æ¿

3. **æ—¥å¿—èšåˆ**ï¼ˆè‡ªæ‰˜ç®¡ï¼‰
   - ELK Stack æˆ– Loki
   - æ—¥å¿—å…¨æ–‡æœç´¢å’Œåˆ†æ

è¯¦è§ `docs/MONITORING.md` ä¸­çš„"æ‰©å±•è·¯å¾„"éƒ¨åˆ†ã€‚

---

**é—®é¢˜åé¦ˆ**: å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ `logs/error.log` æˆ–è¿è¡Œ `docker-compose logs web`
